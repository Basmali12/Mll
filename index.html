<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ’¬ Ø¯Ø±Ø¯Ø´Ø© Ø°ÙƒÙŠØ© Ø¹Ø¨Ø± Hugging Face Inference API</title>
    <style>
        /* ğŸ¨ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ (CSS) */
        body { font-family: sans-serif; background-color: #f0f4f8; padding: 20px; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .container { max-width: 650px; background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        h1 { color: #00bcd4; text-align: center; margin-bottom: 10px; } /* Ù„ÙˆÙ† Ø£Ø²Ø±Ù‚ Ø³Ù…Ø§ÙˆÙŠ */
        #chat-window { height: 350px; border: 1px solid #ccc; padding: 10px; overflow-y: scroll; margin-bottom: 15px; background: #fafafa; border-radius: 8px; }
        .message { margin-bottom: 10px; padding: 8px 12px; border-radius: 15px; max-width: 80%; line-height: 1.5; }
        .user { background-color: #e0f7fa; margin-right: auto; } /* Ø£Ø²Ø±Ù‚ ÙØ§ØªØ­ Ø¬Ø¯Ø§Ù‹ */
        .ai { background-color: #00bcd4; color: white; margin-left: auto; font-style: italic; } /* Ø£Ø²Ø±Ù‚ Ø³Ù…Ø§ÙˆÙŠ */
        .ai.loading { background-color: #ffcc80; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
        #input-area { display: flex; gap: 10px; }
        #user-input { flex-grow: 1; padding: 10px; border: 1px solid #ccc; border-radius: 6px; }
        #send-btn { background-color: #00bcd4; color: white; padding: 10px 15px; border: none; border-radius: 6px; cursor: pointer; transition: background-color 0.3s; }
        #send-btn:hover:not(:disabled) { background-color: #0097a7; }
        #send-btn:disabled { background-color: #80deea; cursor: not-allowed; }
        #status-bar { margin-top: 10px; color: #00bcd4; text-align: center; font-weight: bold; }
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸ—£ï¸ Ø¯Ø±Ø¯Ø´Ø© Ù…Ø¯Ø¹ÙˆÙ…Ø© Ø¨Ù†Ù…ÙˆØ°Ø¬ Hugging Face</h1>
        
        <p style="text-align: center; color: #333;">(ÙŠØ³ØªØ®Ø¯Ù… Ù†Ù…ÙˆØ°Ø¬ **Zephyr-7B-Beta** ÙˆÙ‡Ùˆ Ø£Ù‚ÙˆÙ‰ Ù„Ù„Ø¯Ø±Ø¯Ø´Ø©)</p>

        <div id="chat-window">
            <div class="message ai">Ù…Ø±Ø­Ø¨Ø§Ù‹! ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…ÙØªØ§Ø­Ùƒ. Ø£Ø±Ø¬Ùˆ Ø£Ù† ÙŠØ¹Ù…Ù„ Ù‡Ø°Ø§ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø´ÙƒÙ„ Ø£ÙØ¶Ù„. Ø§Ø³Ø£Ù„Ù†ÙŠ Ø£ÙŠ Ø´ÙŠØ¡!</div>
        </div>

        <div id="input-area">
            <input type="text" id="user-input" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..." autofocus>
            <button id="send-btn">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>

        <div id="status-bar"></div>
    </div>

    <script>
        // âš™ï¸ ÙƒÙˆØ¯ JavaScript Ù…Ø¶Ù…Ù‘Ù†

        const chatWindow = document.getElementById('chat-window');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const statusBar = document.getElementById('status-bar');

        // **********************************************
        // ** Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ ØªÙ… ÙˆØ¶Ø¹Ù‡ Ù‡Ù†Ø§ Ø¨Ù†Ø¬Ø§Ø­ âœ… **
        // **********************************************
        const HF_TOKEN = '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'; 
        
        // Ù†Ù‚Ø·Ø© Ù†Ù‡Ø§ÙŠØ© Inference API Ù„Ù†Ù…ÙˆØ°Ø¬ Zephyr-7B-Beta (Ù†Ù…ÙˆØ°Ø¬ Ø¯Ø±Ø¯Ø´Ø© Ø¬ÙŠØ¯)
        const HF_MODEL_ENDPOINT = "https://api-inference.huggingface.co/models/HuggingFaceH4/zephyr-7b-beta"; 
        
        // **********************************************

        function addMessage(text, sender, isLoading = false) {
            const msgDiv = document.createElement('div');
            msgDiv.classList.add('message', sender);
            if (isLoading) {
                msgDiv.classList.add('loading');
                msgDiv.textContent = '... Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø¯';
            } else {
                msgDiv.textContent = text;
            }
            chatWindow.appendChild(msgDiv);
            chatWindow.scrollTop = chatWindow.scrollHeight;
            return msgDiv; 
        }

        async function sendMessage() {
            const userText = userInput.value.trim();
            if (!userText || !HF_TOKEN) {
                statusBar.textContent = "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ÙˆØªØ£ÙƒÙŠØ¯ ÙˆØ¬ÙˆØ¯ Ù…ÙØªØ§Ø­ Access Token.";
                return;
            }

            addMessage(userText, 'user');
            
            userInput.value = '';
            userInput.disabled = true;
            sendBtn.disabled = true;
            statusBar.textContent = 'Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰ Hugging Face...';

            const loadingMessage = addMessage('', 'ai', true);

            try {
                const response = await fetch(HF_MODEL_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${HF_TOKEN}` // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙØªØ§Ø­Ùƒ
                    },
                    body: JSON.stringify({
                        inputs: userText,
                        parameters: {
                            max_new_tokens: 150, // Ø²ÙŠØ§Ø¯Ø© Ø·ÙˆÙ„ Ø§Ù„Ø±Ø¯
                            temperature: 0.7,
                            return_full_text: false,
                            // ØªÙØ¹ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„ÙƒÙ† Ù…ÙÙŠØ¯)
                            do_sample: true 
                        }
                    })
                });
                
                if (!response.ok) {
                    // Ù‚Ø±Ø§Ø¡Ø© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ Ù…Ù† Hugging Face
                    const errorData = await response.json();
                    throw new Error(`Ø®Ø·Ø£ ÙÙŠ API: ${response.status} - ${errorData.error || response.statusText}`);
                }

                const data = await response.json();
                
                let aiResponse;
                
                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø±Ø¯ (ÙŠØ®ØªÙ„Ù Ø­Ø³Ø¨ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬)
                if (Array.isArray(data) && data.length > 0 && data[0].generated_text) {
                    aiResponse = data[0].generated_text.trim();
                } else {
                    aiResponse = "ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø±Ø¯ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ Ù…Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.";
                }

                loadingMessage.classList.remove('loading');
                loadingMessage.textContent = aiResponse;
                statusBar.textContent = "ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø±Ø¯ Ø¨Ù†Ø¬Ø§Ø­.";

            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù€ API:", error);
                loadingMessage.classList.remove('loading');
                // Ù‚Ø¯ ØªÙƒÙˆÙ† Ù…Ø´ÙƒÙ„Ø© Failed to fetch Ø¨Ø³Ø¨Ø¨ CORS Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.
                loadingMessage.textContent = error.message.includes("fetch") ? 
                                             "Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù…Ø§ Ø²Ø§Ù„Øª Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ù‚Ø§Ø¦Ù…Ø© (Failed to fetch). ÙŠØ±Ø¬Ù‰ Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ Ø¹Ù„Ù‰ Ù…Ù†ØµØ© ÙˆÙŠØ¨ Ø®Ø§Ø±Ø¬ÙŠØ©." :
                                             `Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£: ${error.message}.`;
                statusBar.textContent = "ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø¯. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©.";
            } finally {
                userInput.disabled = false;
                sendBtn.disabled = false;
                userInput.focus(); 
            }
        }

        // Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        sendBtn.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !sendBtn.disabled) {
                sendMessage();
            }
        });
        
        statusBar.textContent = "Ø§Ù„ÙƒÙˆØ¯ ÙˆØ§Ù„Ù…ÙØªØ§Ø­ Ø¬Ø§Ù‡Ø²Ø§Ù†. Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©!";
    </script>
</body>
</html>
